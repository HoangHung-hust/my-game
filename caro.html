<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Caro</title>

<style>
body{
    background:#0f0f0f;
    color:#eee;
    font-family:Arial;
    text-align:center;
}

#topbar{
    padding:10px;
    border-bottom:1px solid #333;
}

input{
    width:160px;
    padding:6px;
    font-size:16px;
    text-align:center;
}

button{
    padding:6px 12px;
    margin-left:5px;
    font-size:15px;
    cursor:pointer;
}

#info{
    margin-top:8px;
    font-size:16px;
}

#board{
    display:grid;
    grid-template-columns:repeat(15,36px);
    gap:1px;
    justify-content:center;
    margin:15px auto;
}

.cell{
    width:36px;
    height:36px;
    background:#222;
    border:1px solid #444;
    font-size:22px;
    line-height:36px;
    cursor:pointer;
    user-select:none;
}

.X{ color:#ff5252; }
.O{ color:#4fc3f7; }

/* ‚≠ê Highlight CH·ªÆ v·ª´a ƒë√°nh */
.last-text{
    text-shadow:
        0 0 6px currentColor,
        0 0 12px currentColor,
        0 0 18px currentColor;
    font-weight:bold;
}
</style>
</head>

<body>

<div id="topbar">
    Round: <b id="round">1</b> |
    L∆∞·ª£t: <b id="turn">X</b><br><br>

    <input id="moveInput" placeholder="Nh·∫≠p XY (vd: 304)">
    <button onclick="undo()">Undo</button>
    <button onclick="nextRound()">Ch∆°i l·∫°i</button>

    <div id="info">N∆∞·ªõc v·ª´a ƒë√°nh: ‚Äî</div>
</div>

<div id="board"></div>

<script>
const SIZE = 15;
const WIN = 5;

let board = [];
let history = [];
let currentPlayer = "X";
let gameOver = false;
let round = 1;

const boardDiv = document.getElementById("board");
const turnSpan = document.getElementById("turn");
const infoDiv = document.getElementById("info");
const moveInput = document.getElementById("moveInput");

/* ===== INIT ===== */
function init(){
    board = Array.from({length:SIZE},()=>Array(SIZE).fill(""));
    boardDiv.innerHTML = "";
    history = [];
    gameOver = false;
    currentPlayer = "X";
    turnSpan.textContent = "X";
    infoDiv.textContent = "N∆∞·ªõc v·ª´a ƒë√°nh: ‚Äî";

    for(let r=0;r<SIZE;r++){
        for(let c=0;c<SIZE;c++){
            const cell = document.createElement("div");
            cell.className = "cell";

            cell.onclick = ()=>{
                const code = (r+1)*100 + (c+1);
                place(r,c,code);
            };

            boardDiv.appendChild(cell);
        }
    }
}

/* ===== ENTER INPUT ===== */
moveInput.addEventListener("keydown",e=>{
    if(e.key==="Enter") playByInput();
});

function playByInput(){
    if(gameOver) return;

    const val = moveInput.value.trim();
    if(!/^\d+$/.test(val)) return alert("Nh·∫≠p XY d·∫°ng s·ªë!");

    const num = +val;
    const x = Math.floor(num/100);
    const y = num % 100;

    if(x<1||x>15||y<1||y>15)
        return alert("Ngo√†i b√†n c·ªù!");

    place(x-1,y-1,num);
    moveInput.value="";
}

/* ===== PLACE ===== */
function place(r,c,code){
    if(gameOver || board[r][c]!="") return;

    // ‚ùå b·ªè highlight ch·ªØ c≈©
    const old = document.querySelector(".last-text");
    if(old) old.classList.remove("last-text");

    const idx = r*SIZE + c;
    const cell = boardDiv.children[idx];

    board[r][c] = currentPlayer;
    cell.textContent = currentPlayer;
    cell.classList.add(currentPlayer, "last-text");

    history.push({r,c,player:currentPlayer,code});
    infoDiv.textContent = `N∆∞·ªõc v·ª´a ƒë√°nh: ${currentPlayer} ‚Üí ${code}`;

    if(checkWin(r,c)){
        gameOver = true;
        setTimeout(()=>alert(`üéâ ${currentPlayer} th·∫Øng!`),50);
        return;
    }

    if(history.length === SIZE*SIZE){
        gameOver = true;
        setTimeout(()=>alert("ü§ù H√≤a!"),50);
        return;
    }

    currentPlayer = currentPlayer==="X" ? "O" : "X";
    turnSpan.textContent = currentPlayer;
}

/* ===== UNDO ===== */
function undo(){
    if(history.length===0 || gameOver) return;

    const last = history.pop();
    board[last.r][last.c] = "";

    const idx = last.r*SIZE + last.c;
    const cell = boardDiv.children[idx];
    cell.textContent="";
    cell.className="cell";

    currentPlayer = last.player;
    turnSpan.textContent = currentPlayer;

    // highlight l·∫°i ch·ªØ tr∆∞·ªõc
    const old = document.querySelector(".last-text");
    if(old) old.classList.remove("last-text");

    if(history.length){
        const prev = history[history.length-1];
        const idx2 = prev.r*SIZE + prev.c;
        boardDiv.children[idx2].classList.add("last-text");
        infoDiv.textContent = `N∆∞·ªõc v·ª´a ƒë√°nh: ${prev.player} ‚Üí ${prev.code}`;
    }else{
        infoDiv.textContent="N∆∞·ªõc v·ª´a ƒë√°nh: ‚Äî";
    }
}

/* ===== NEXT ROUND ===== */
function nextRound(){
    round++;
    document.getElementById("round").textContent = round;
    init();
}

/* ===== CHECK WIN ===== */
function checkWin(r,c){
    return (
        count(r,c,1,0)+count(r,c,-1,0)>=4 ||
        count(r,c,0,1)+count(r,c,0,-1)>=4 ||
        count(r,c,1,1)+count(r,c,-1,-1)>=4 ||
        count(r,c,1,-1)+count(r,c,-1,1)>=4
    );
}

function count(r,c,dr,dc){
    let i=r+dr,j=c+dc,cnt=0;
    while(i>=0&&i<SIZE&&j>=0&&j<SIZE&&board[i][j]===currentPlayer){
        cnt++; i+=dr; j+=dc;
    }
    return cnt;
}

init();
</script>

</body>
</html>
